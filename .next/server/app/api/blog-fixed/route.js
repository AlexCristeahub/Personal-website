"use strict";(()=>{var e={};e.id=897,e.ids=[897],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},405:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>D,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var a={};s.r(a),s.d(a,{GET:()=>u});var o=s(3278),r=s(5002),i=s(4877),l=s(1309);let n=new(s(9081)).Client({auth:process.env.NOTION_TOKEN});async function u(){try{console.log("\uD83D\uDD0D Fixed API - Starting...");let e=process.env.NOTION_DATABASE_ID;if(!process.env.NOTION_TOKEN||!e)throw Error("Missing environment variables");let t=function(e){let t=e.replace(/-/g,"");if(32!==t.length)throw Error(`Invalid database ID format. Expected 32 characters, got ${t.length}`);return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20,32)}`}(e);console.log("\uD83D\uDD0D Fixed API - Using database ID:",t);let s=await n.databases.retrieve({database_id:t});if(console.log("\uD83D\uDD0D Fixed API - Database retrieved"),console.log("\uD83D\uDD0D Fixed API - Data sources:",s.data_sources?.length||0),!s.data_sources||0===s.data_sources.length)return console.log("❌ Fixed API - No data sources found"),l.NextResponse.json({posts:[],debug:{totalPosts:0,allTags:[],error:"No data sources found in database"}});let a=s.data_sources[0].id;console.log("\uD83D\uDD0D Fixed API - Using data source:",a);let o=await n.dataSources.query({data_source_id:a,filter:{property:"Published",checkbox:{equals:!0}},sorts:[{property:"Published Date",direction:"descending"}]});console.log("\uD83D\uDD0D Fixed API - Query successful, found",o.results.length,"pages");let r=o.results.map(e=>{let t=e.properties;console.log("\uD83C\uDFF7️ Fixed API - Page:",t.Title?.title?.[0]?.plain_text),console.log("\uD83C\uDFF7️ Fixed API - Raw Tags property:",JSON.stringify(t.Tags,null,2));let s=[];t.Tags&&(t.Tags.multi_select?s=t.Tags.multi_select.map(e=>e.name)||[]:t.Tags.select?s=[t.Tags.select.name]:Array.isArray(t.Tags)&&(s=t.Tags.map(e=>e.name||e).filter(Boolean))),console.log("\uD83C\uDFF7️ Fixed API - Extracted tags:",s);let a=e.id;return t.Slug?.rich_text?.[0]?.plain_text?a=t.Slug.rich_text[0].plain_text:t.Title?.title?.[0]?.plain_text&&(a=t.Title.title[0].plain_text.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")),{id:e.id,title:t.Title?.title?.[0]?.plain_text||"Untitled",slug:a,excerpt:t.Excerpt?.rich_text?.[0]?.plain_text,cover:e.cover?.external?.url||e.cover?.file?.url,publishedDate:t["Published Date"]?.date?.start||e.created_time,lastEditedTime:e.last_edited_time,tags:s,published:t.Published?.checkbox||!1}}),i=[...new Set(r.flatMap(e=>e.tags))];return console.log("\uD83C\uDFF7️ Fixed API - All unique tags:",i),l.NextResponse.json({posts:r,debug:{totalPosts:r.length,allTags:i,hasNotionToken:!!process.env.NOTION_TOKEN,hasNotionDatabase:!!process.env.NOTION_DATABASE_ID,timestamp:new Date().toISOString(),dataSourceId:a,sampleTagsProperty:r[0]?.tags?"Found tags":"No tags found"}})}catch(e){return console.error("❌ Fixed API Error:",e),l.NextResponse.json({posts:[],error:"Failed to fetch blog posts",details:e.message,debug:{hasNotionToken:!!process.env.NOTION_TOKEN,hasNotionDatabase:!!process.env.NOTION_DATABASE_ID,timestamp:new Date().toISOString()}},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/blog-fixed/route",pathname:"/api/blog-fixed",filename:"route",bundlePath:"app/api/blog-fixed/route"},resolvedPagePath:"/Users/alex/Downloads/personal/Personal-website/app/api/blog-fixed/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:g}=d,D="/api/blog-fixed/route";function x(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[787,793],()=>s(405));module.exports=a})();